# Java ì˜ˆì™¸ ì²˜ë¦¬ íŒ¨í„´ ìš”ì•½ë³¸

## 03. ì½”ë“œì—ì„œ ì‹ ê²½ ì¨ì•¼ í•  ì˜ˆì™¸ì™€ ì˜¤ë¥˜ ì²˜ë¦¬ íŒ¨í„´

### 3.1 ì˜ˆì™¸ì˜ ê³„ì¸µ êµ¬ì¡°

**Java ì˜ˆì™¸ ì‹œìŠ¤í…œì˜ í•µì‹¬ êµ¬ì¡°**

Javaì—ì„œ ëª¨ë“  ì˜ˆì™¸ëŠ” `Throwable`ì„ ìƒì†ë°›ëŠ” ê°ì²´ë¡œ, í¬ê²Œ ë‘ ê°€ì§€ë¡œ ë¶„ë¥˜ë©ë‹ˆë‹¤:

```
Object
   â†“
Throwable
   â†“
Exceptions â†â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â†’ Error
   â†“                              â†“
í™•ì¸ëœ(Checked)               VirtualMachineError
- IOException                     â†“
- InterruptedException      AssertionError ë“±
   â†“
í™•ì¸ë˜ì§€ ì•Šì€(Unchecked)
- IllegalArgumentException
- NullPointerException
```

**í™•ì¸ëœ ì˜ˆì™¸(Checked Exception)**
- ì»´íŒŒì¼ íƒ€ì„ì— ì²˜ë¦¬ë¥¼ ê°•ì œí•˜ëŠ” ì˜ˆì™¸
- ë©”ì„œë“œ ì‹œê·¸ë‹ˆì²˜ì— `throws` ì„ ì–¸ í•„ìš”
- ë³µêµ¬ ê°€ëŠ¥í•œ ì˜ˆì™¸ ìƒí™©ì— ì£¼ë¡œ ì‚¬ìš©
- ì˜ˆ: `IOException`, `InterruptedException`

**í™•ì¸ë˜ì§€ ì•Šì€ ì˜ˆì™¸(Unchecked Exception)**
- ì»´íŒŒì¼ëŸ¬ê°€ ì²˜ë¦¬ë¥¼ ê°•ì œí•˜ì§€ ì•ŠëŠ” ì˜ˆì™¸
- `RuntimeException`ì„ ìƒì†ë°›ìŒ
- í”„ë¡œê·¸ë˜ë° ì˜¤ë¥˜ë‚˜ ë…¼ë¦¬ì  ì˜¤ë¥˜ì— ì£¼ë¡œ ì‚¬ìš©
- ì˜ˆ: `IllegalArgumentException`, `NullPointerException`

**ì˜ˆì™¸ ì²˜ë¦¬ ì„¸ë¶„í™” ì „ëµ**

ì„¸ë¶„í™”ëœ ì˜ˆì™¸ ì²˜ë¦¬ëŠ” ê°ê°ì˜ ì˜ˆì™¸ ìƒí™©ì— ë§ëŠ” ì ì ˆí•œ ëŒ€ì‘ì„ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤:

```java
// êµ¬ì²´ì  ì˜ˆì™¸ë³„ ì²˜ë¦¬ - ê¶Œì¥ ë°©ì‹
public void shouldCatchAtNormalGranularity() {
    try {
        methodThatThrowsCheckedException();
    } catch (FileAlreadyExistsException e) {
        logger.error("File already exists: ", e);
        // íŒŒì¼ì´ ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ê²½ìš°ì˜ êµ¬ì²´ì  ì²˜ë¦¬
    } catch (InterruptedException e) {
        logger.error("Interrupted", e);
        Thread.currentThread().interrupt(); // ì¸í„°ëŸ½íŠ¸ ìƒíƒœ ë³µì›
    }
}

// ìƒìœ„ íƒ€ì…ìœ¼ë¡œ í¬ê´„ì  ì²˜ë¦¬
public void shouldCatchAtHigherGranularity() {
    try {
        methodThatThrowsCheckedException();
    } catch (IOException e) {
        // FileAlreadyExistsExceptionë„ IOExceptionì„ ìƒì†ë°›ìœ¼ë¯€ë¡œ ì—¬ê¸°ì„œ ì²˜ë¦¬
        logger.error("IO problem occurred: ", e);
    } catch (InterruptedException e) {
        logger.error("Interrupted", e);
    }
}

// ëª¨ë“  ì˜ˆì™¸ë¥¼ í•œ ë²ˆì— ì²˜ë¦¬ - ì£¼ì˜í•´ì„œ ì‚¬ìš©
public void shouldCatchAtCatchAll() {
    try {
        methodThatThrowsCheckedException();
    } catch (Exception e) {
        logger.error("Unexpected problem occurred: ", e);
        // ëª¨ë“  ì˜ˆì™¸ë¥¼ ë™ì¼í•˜ê²Œ ì²˜ë¦¬í•˜ë¯€ë¡œ êµ¬ì²´ì  ëŒ€ì‘ ë¶ˆê°€
    }
}
```

### 3.2 APIì—ì„œì˜ ì˜ˆì™¸ ì²˜ë¦¬ ëª¨ë²” ì‚¬ë¡€

ê³µê°œ APIë¥¼ ì„¤ê³„í•  ë•ŒëŠ” í˜¸ì¶œìê°€ ì˜ˆìƒí•  ìˆ˜ ìˆê³  ì ì ˆíˆ ëŒ€ì‘í•  ìˆ˜ ìˆëŠ” ì˜ˆì™¸ ì „ëµì´ ì¤‘ìš”í•©ë‹ˆë‹¤.

#### 3.2.1 ê³µê°œ APIì—ì„œ Checked Exception ì²˜ë¦¬

**ëª…ì‹œì  ì˜ˆì™¸ ì„ ì–¸**
```java
// API ë©”ì„œë“œì—ì„œ ë°œìƒí•  ìˆ˜ ìˆëŠ” ì˜ˆì™¸ë¥¼ ëª…ì‹œì ìœ¼ë¡œ ì„ ì–¸
void check() throws IOException, InterruptedException;
```

**Checked Exceptionì„ Uncheckedë¡œ ê°ì‹¸ê¸°**
```java
public void wrapIntoUnchecked() {
    try {
        check();
    } catch (RuntimeException e) {
        throw e; // RuntimeExceptionì€ ê·¸ëŒ€ë¡œ ì „íŒŒ
    } catch (Exception e) {
        // Checked Exceptionì„ RuntimeExceptionìœ¼ë¡œ ê°ì‹¸ì„œ ì „íŒŒ
        throw new RuntimeException(e);
    }
}
```

ì´ íŒ¨í„´ì€ ë‹¤ìŒê³¼ ê°™ì€ ì¥ì ì´ ìˆìŠµë‹ˆë‹¤:
- í˜¸ì¶œìê°€ ì˜ˆì™¸ ì²˜ë¦¬ë¥¼ ê°•ì œë°›ì§€ ì•ŠìŒ
- ì›ë³¸ ì˜ˆì™¸ ì •ë³´ëŠ” causeë¡œ ë³´ì¡´
- API ì‚¬ìš©ì„± í–¥ìƒ

#### 3.2.2 ê³µê°œ APIì—ì„œ Unchecked Exception ì²˜ë¦¬

**ì…ë ¥ ê²€ì¦ê³¼ ìƒíƒœ ê²€ì¦**
```java
public void setupService(int numberOfThreads)
    throws IllegalStateException, IllegalArgumentException {
    
    // ì…ë ¥ê°’ ê²€ì¦
    if (numberOfThreads < 0) {
        throw new IllegalArgumentException(
            "Number of threads cannot be lower than 0.");
    }
    
    // ê°ì²´ ìƒíƒœ ê²€ì¦
    if (running) {
        throw new IllegalStateException(
            "The service is already running.");
    }
    
    // ì •ìƒ ë¡œì§ ìˆ˜í–‰
    this.numberOfThreads = numberOfThreads;
    this.running = true;
}
```

Unchecked Exception ì‚¬ìš© ì‹œ ê³ ë ¤ì‚¬í•­:
- **IllegalArgumentException**: ì˜ëª»ëœ ë§¤ê°œë³€ìˆ˜ ì „ë‹¬ ì‹œ
- **IllegalStateException**: ê°ì²´ê°€ ë¶€ì ì ˆí•œ ìƒíƒœì¼ ë•Œ
- **NullPointerException**: null ê°’ì´ í—ˆìš©ë˜ì§€ ì•Šì„ ë•Œ

### 3.3 ì˜ˆì™¸ ì²˜ë¦¬ ì•ˆí‹° íŒ¨í„´ê³¼ ì˜¬ë°”ë¥¸ ìì› ê´€ë¦¬

#### 3.3.1 ìì› í•´ì œ íŒ¨í„´

**âŒ ì˜ëª»ëœ ìì› ê´€ë¦¬**
```java
CloseableHttpClient client = HttpClients.createDefault();
try {
    processRequests(client);
    client.close(); // ì˜ˆì™¸ ë°œìƒ ì‹œ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ
} catch (IOException e) {
    logger.error("Problem", e);
}
```

**âœ… try-with-resources ì‚¬ìš© (ê¶Œì¥)**
```java
try (CloseableHttpClient client = HttpClients.createDefault()) {
    processRequests(client);
} catch (IOException e) {
    logger.error("Problem when processing requests", e);
}
// client.close()ê°€ ìë™ìœ¼ë¡œ í˜¸ì¶œë¨
```

**âœ… finally ë¸”ë¡ ì‚¬ìš© (í•„ìš”ì‹œ)**
```java
CloseableHttpClient client = HttpClients.createDefault();
try {
    processRequests(client);
} finally {
    if (client != null) {
        try {
            client.close();
        } catch (IOException e) {
            logger.warn("Failed to close client", e);
        }
    }
}
```

#### try-with-resourcesì˜ ì¥ì 
- ìë™ ìì› í•´ì œë¡œ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€
- ì˜ˆì™¸ ë°œìƒ ì‹œì—ë„ ì•ˆì „í•œ ìì› ì •ë¦¬
- ì½”ë“œ ê°„ì†Œí™” ë° ê°€ë…ì„± í–¥ìƒ
- suppressed exception ì²˜ë¦¬

### 3.4 íƒ€ì‚¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì˜ˆì™¸ ì²˜ë¦¬

ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ì˜ˆì™¸ë¥¼ ê·¸ëŒ€ë¡œ ë…¸ì¶œí•˜ë©´ ê°•í•œ ê²°í•©ì´ ë°œìƒí•©ë‹ˆë‹¤. ë„ë©”ì¸ë³„ ì˜ˆì™¸ë¥¼ ë§Œë“¤ì–´ ê²°í•©ë„ë¥¼ ë‚®ì¶°ì•¼ í•©ë‹ˆë‹¤.

**ë„ë©”ì¸ ì „ìš© ì˜ˆì™¸ í´ë˜ìŠ¤ ì„¤ê³„**
```java
public class PersonCatalogException extends Exception {
    // private ìƒì„±ìë¡œ ì§ì ‘ ìƒì„± ë°©ì§€
    private PersonCatalogException(String message, Throwable cause) {
        super(message, cause);
    }
    
    // ì •ì  íŒ©í† ë¦¬ ë©”ì„œë“œë¡œ ì˜ë¯¸ìˆëŠ” ì˜ˆì™¸ ìƒì„±
    public static PersonCatalogException getPersonException(String personName, Throwable t) {
        return new PersonCatalogException(
            "Problem when getting person file for: " + personName, t);
    }
    
    public static PersonCatalogException createPersonException(String personName, Throwable t) {
        return new PersonCatalogException(
            "Problem when creating person file for: " + personName, t);
    }
}
```

**API ì¸í„°í˜ì´ìŠ¤ì—ì„œ ë„ë©”ì¸ ì˜ˆì™¸ ì‚¬ìš©**
```java
public interface PersonCatalog {
    // íƒ€ì‚¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì˜ˆì™¸(FileExistsException) ëŒ€ì‹  ë„ë©”ì¸ ì˜ˆì™¸ ì‚¬ìš©
    PersonInfo getPersonInfo(String personName) throws PersonCatalogException;
    boolean createPersonInfo(String personName, int amount) throws PersonCatalogException;
}
```

**êµ¬í˜„ì²´ì—ì„œ ì˜ˆì™¸ ë³€í™˜**
```java
public class PersonCatalogImpl implements PersonCatalog {
    @Override
    public PersonInfo getPersonInfo(String personName) throws PersonCatalogException {
        try {
            // íƒ€ì‚¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ API í˜¸ì¶œ
            return externalLibrary.readPersonFile(personName);
        } catch (FileNotFoundException e) {
            throw PersonCatalogException.getPersonException(personName, e);
        } catch (IOException e) {
            throw PersonCatalogException.getPersonException(personName, e);
        }
    }
}
```

### 3.5 ë©€í‹°ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œì˜ ì˜ˆì™¸ ì²˜ë¦¬

ë¹„ë™ê¸° í”„ë¡œê·¸ë˜ë°ì—ì„œëŠ” ì˜ˆì™¸ê°€ ë‹¤ë¥¸ ìŠ¤ë ˆë“œì—ì„œ ë°œìƒí•˜ë¯€ë¡œ íŠ¹ë³„í•œ ì²˜ë¦¬ê°€ í•„ìš”í•©ë‹ˆë‹¤.

#### 3.5.1 CompletableFutureë¥¼ ì´ìš©í•œ ì˜ˆì™¸ ì²˜ë¦¬

**ê¸°ë³¸ì ì¸ ë¹„ë™ê¸° ì˜ˆì™¸ ì²˜ë¦¬**
```java
public CompletableFuture<Integer> asyncExternalCall() {
    return CompletableFuture.supplyAsync(() -> {
        try {
            return externalCall(); // IOExceptionì„ ë˜ì§ˆ ìˆ˜ ìˆëŠ” ë©”ì„œë“œ
        } catch (IOException e) {
            // Checked Exceptionì„ Uncheckedë¡œ ë³€í™˜
            throw new RuntimeException(e);
        }
    });
}
```

**ëª…ì‹œì  ì™„ì„± ì²˜ë¦¬**
```java
public CompletableFuture<Integer> betterAsyncCall() {
    CompletableFuture<Integer> future = new CompletableFuture<>();
    CompletableFuture.runAsync(() -> {
        try {
            Integer result = externalCall();
            future.complete(result); // ì„±ê³µ ì‹œ ê²°ê³¼ ì„¤ì •
        } catch (IOException e) {
            future.completeExceptionally(e); // ì‹¤íŒ¨ ì‹œ ì˜ˆì™¸ ì„¤ì •
        }
    });
    return future;
}
```

**ì˜ˆì™¸ ì²´ì¸ ì²˜ë¦¬**
```java
CompletableFuture<String> result = asyncExternalCall()
    .thenApply(value -> value.toString())
    .exceptionally(throwable -> {
        logger.error("Async operation failed", throwable);
        return "DEFAULT_VALUE";
    });
```

### 3.6 Try ëª¨ë‚˜ë“œë¥¼ í†µí•œ í•¨ìˆ˜í˜• ì˜¤ë¥˜ ì²˜ë¦¬

í•¨ìˆ˜í˜• í”„ë¡œê·¸ë˜ë°ì—ì„œëŠ” ì˜ˆì™¸ ëŒ€ì‹  `Try` ëª¨ë‚˜ë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ì˜¤ë¥˜ë¥¼ ê°’ìœ¼ë¡œ ë‹¤ë£¹ë‹ˆë‹¤.

**Try ëª¨ë‚˜ë“œì˜ ê¸°ë³¸ ì‚¬ìš©ë²•**
```java
// ì„±ê³µí•˜ëŠ” ê²½ìš°
String defaultResult = "default";
Supplier<Integer> clientAction = () -> 100;

Try<Integer> response = Try.ofSupplier(clientAction);
String result = response.map(Object::toString).getOrElse(defaultResult);
// ê²°ê³¼: "100"

// ì‹¤íŒ¨í•˜ëŠ” ê²½ìš°
Supplier<Integer> failingAction = () -> {
    throw new RuntimeException("problem");
};

Try<Integer> failedResponse = Try.ofSupplier(failingAction);
String failedResult = failedResponse.map(Object::toString).getOrElse(defaultResult);
// ê²°ê³¼: "default"
```

**ì‹¤ì œ HTTP ì„œë¹„ìŠ¤ í˜¸ì¶œ ì˜ˆì œ**
```java
public String getId() {
    CloseableHttpClient client = HttpClients.createDefault();
    HttpGet httpGet = new HttpGet("http://external-service/resource");
    
    Try<HttpResponse> response = Try.of(() -> client.execute(httpGet));
    return response
        .mapTry(this::extractStringBody)    // IOExceptionì„ ë˜ì§ˆ ìˆ˜ ìˆëŠ” ë©”ì„œë“œ
        .mapTry(this::toEntity)             // JsonProcessingException ê°€ëŠ¥
        .map(this::extractUserId)           // ì•ˆì „í•œ ë³€í™˜
        .onFailure(ex -> logger.error("The getId() failed.", ex))
        .getOrElse("DEFAULT_ID");
}

private String extractStringBody(HttpResponse response) throws IOException {
    return new BufferedReader(
        new InputStreamReader(response.getEntity().getContent(),
            StandardCharsets.UTF_8))
        .lines()
        .collect(Collectors.joining("\n"));
}
```

**Try vs ì „í†µì  ì˜ˆì™¸ ì²˜ë¦¬ ë¹„êµ**
```java
// Try ëª¨ë‚˜ë“œ ë°©ì‹ - í•¨ìˆ˜í˜•
public String getIdWithTry() {
    return Try.of(() -> externalService.call())
        .mapTry(this::processResponse)
        .map(this::extractId)
        .recover(throwable -> "DEFAULT_ID")
        .get();
}

// ì „í†µì  ì˜ˆì™¸ ì²˜ë¦¬ ë°©ì‹
public String getIdWithExceptions() {
    try {
        String response = externalService.call();
        ProcessedData data = processResponse(response);
        return extractId(data);
    } catch (Exception e) {
        logger.error("Failed to get ID", e);
        return "DEFAULT_ID";
    }
}
```

### 3.7 ì„±ëŠ¥ ë¹„êµ ë° ê³ ë ¤ì‚¬í•­

JMH(Java Microbenchmark Harness)ë¥¼ ì´ìš©í•œ ì„±ëŠ¥ ì¸¡ì • ê²°ê³¼:

**ë²¤ì¹˜ë§ˆí¬ ê²°ê³¼ ë¶„ì„**
- **baseline** (ì¼ë°˜ ê°ì²´ ìƒì„±): ~1ms
- **throwCatch** (ì˜ˆì™¸ ìƒì„±/ì²˜ë¦¬): ~100ms
- **getStackTrace** (ìŠ¤íƒ ì¶”ì  í¬í•¨): ~2500ms
- **Try ëª¨ë‚˜ë“œ**: ~100ms (throwCatchì™€ ìœ ì‚¬)

**ì„±ëŠ¥ ìµœì í™” ì§€ì¹¨**
1. **ìŠ¤íƒ ì¶”ì ì´ ì„±ëŠ¥ì— ê°€ì¥ í° ì˜í–¥**: í•„ìš”í•˜ì§€ ì•Šë‹¤ë©´ ìŠ¤íƒ ì¶”ì  ì‚¬ìš© ìµœì†Œí™”
2. **Try ëª¨ë‚˜ë“œ vs ì˜ˆì™¸ ì²˜ë¦¬**: ì„±ëŠ¥ ì°¨ì´ëŠ” ë¯¸ë¯¸í•˜ë¯€ë¡œ ì½”ë“œ ìŠ¤íƒ€ì¼ê³¼ íŒ€ ì„ í˜¸ë„ì— ë”°ë¼ ì„ íƒ
3. **ì˜ˆì™¸ëŠ” ì˜ˆì™¸ì  ìƒí™©ì—ë§Œ**: ì •ìƒì ì¸ ì œì–´ íë¦„ì—ëŠ” ì‚¬ìš©í•˜ì§€ ë§ ê²ƒ

## 04. ìœ ì—°ì„±ê³¼ ë³µì¡ì„± ì‚¬ì´ì˜ ê· í˜•

### 4.1 ê²¬ê³ í•˜ì§€ë§Œ í™•ì¥ì„±ì´ ë–¨ì–´ì§€ëŠ” API

ì‹¤ì œ í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” HTTP í´ë¼ì´ì–¸íŠ¸ ì˜ˆì œë¥¼ í†µí•´ API ì„¤ê³„ì˜ ì§„í™”ë¥¼ ì‚´í´ë´…ì‹œë‹¤.

#### ì¬ì‹œë„ ë¡œì§ì„ ê°€ì§„ HTTP í´ë¼ì´ì–¸íŠ¸ ì„¤ê³„

**ì´ˆê¸° êµ¬í˜„ - ë‹¨ìˆœí•˜ì§€ë§Œ ìœ ì—°ì„± ë¶€ì¡±**
```java
public class HttpClientExecution {
    private final int maxNumberOfRetries;
    private final CloseableHttpClient client;
    private final Meter successMeter;
    private final Meter failureMeter;
    private final Meter retryCounter;

    public HttpClientExecution(
        MetricRegistry metricRegistry, 
        int maxNumberOfRetries,
        CloseableHttpClient client) {
        
        this.successMeter = metricRegistry.meter("requests.success");
        this.failureMeter = metricRegistry.meter("requests.failure");
        this.retryCounter = metricRegistry.meter("requests.retry");
        this.maxNumberOfRetries = maxNumberOfRetries;
        this.client = client;
    }

    public void executeWithRetry(String path) {
        for (int i = 0; i <= maxNumberOfRetries; i++) {
            try {
                execute(path);
                return; // ì„±ê³µ ì‹œ ì¦‰ì‹œ ë°˜í™˜
            } catch (IOException e) {
                logger.error("Request failed, retry: " + i, e);
                failureMeter.mark();
                
                if (maxNumberOfRetries == i) {
                    logger.error("Max retries reached, failing.");
                    throw new RuntimeException(e);
                } else {
                    logger.info("Retrying request...");
                    retryCounter.mark();
                }
            }
        }
    }

    private void execute(String path) throws IOException {
        CloseableHttpResponse response = client.execute(new HttpPost(path));
        if (response.getStatusLine().getStatusCode() == HttpStatus.SC_OK) {
            successMeter.mark();
        } else {
            failureMeter.mark();
        }
    }
}
```

**ì´ êµ¬í˜„ì˜ í•œê³„ì **
- íŠ¹ì • ë©”íŠ¸ë¦­ ë¼ì´ë¸ŒëŸ¬ë¦¬(Codahale Metrics)ì— ê°•í•˜ê²Œ ê²°í•©
- ë‹¤ë¥¸ ë©”íŠ¸ë¦­ ì‹œìŠ¤í…œ ì‚¬ìš© ì‹œ ì½”ë“œ ìˆ˜ì • í•„ìš”
- í™•ì¥ì„±ê³¼ ìœ ì—°ì„± ë¶€ì¡±

### 4.2 í´ë¼ì´ì–¸íŠ¸ ë§ì¶¤í˜• ë©”íŠ¸ë¦­ í”„ë ˆì„ì›Œí¬ ì§€ì›

íƒ€ì‚¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì˜ì¡´ì„±ì„ ì¤„ì´ê³  ìœ ì—°ì„±ì„ ë†’ì´ê¸° ìœ„í•œ ì¶”ìƒí™” ë„ì…:

#### ë©”íŠ¸ë¦­ ì¶”ìƒí™” ë ˆì´ì–´ ì„¤ê³„

**ë©”íŠ¸ë¦­ ì¸í„°í˜ì´ìŠ¤ ì •ì˜**
```java
public interface MetricsProvider {
    void incrementSuccess();
    void incrementFailure();
    void incrementRetry();
}
```

**êµ¬ì²´ì  êµ¬í˜„ì²´ - Codahale Metrics**
```java
public class DefaultMetricsProvider implements MetricsProvider {
    private final Meter successMeter;
    private final Meter failureMeter;
    private final Meter retryCounter;
    
    public DefaultMetricsProvider(MetricRegistry metricRegistry) {
        this.successMeter = metricRegistry.meter("requests.success");
        this.failureMeter = metricRegistry.meter("requests.failure");
        this.retryCounter = metricRegistry.meter("requests.retry");
    }
    
    @Override
    public void incrementSuccess() {
        successMeter.mark();
    }
    
    @Override
    public void incrementFailure() {
        failureMeter.mark();
    }
    
    @Override
    public void incrementRetry() {
        retryCounter.mark();
    }
}
```

**ê°œì„ ëœ HttpClientExecution**
```java
public class HttpClientExecution {
    private final int maxNumberOfRetries;
    private final CloseableHttpClient client;
    private final MetricsProvider metricsProvider; // ì¶”ìƒí™”ëœ ì¸í„°í˜ì´ìŠ¤ ì‚¬ìš©

    public HttpClientExecution(
        MetricsProvider metricsProvider,
        int maxNumberOfRetries,
        CloseableHttpClient client) {
        
        this.metricsProvider = metricsProvider;
        this.maxNumberOfRetries = maxNumberOfRetries;
        this.client = client;
    }

    public void executeWithRetry(String path) {
        for (int i = 0; i <= maxNumberOfRetries; i++) {
            try {
                execute(path);
                return;
            } catch (IOException e) {
                logger.error("Request failed, retry: " + i, e);
                metricsProvider.incrementFailure(); // ì¶”ìƒí™”ëœ ë©”ì„œë“œ í˜¸ì¶œ
                
                if (maxNumberOfRetries == i) {
                    throw new RuntimeException(e);
                } else {
                    metricsProvider.incrementRetry();
                }
            }
        }
    }

    private void execute(String path) throws IOException {
        CloseableHttpResponse response = client.execute(new HttpPost(path));
        if (response.getStatusLine().getStatusCode() == HttpStatus.SC_OK) {
            metricsProvider.incrementSuccess();
        } else {
            metricsProvider.incrementFailure();
        }
    }
}
```

**ë‹¤ë¥¸ ë©”íŠ¸ë¦­ ì‹œìŠ¤í…œì„ ìœ„í•œ êµ¬í˜„ì²´ ì˜ˆì œ**
```java
// Micrometerë¥¼ ì‚¬ìš©í•˜ëŠ” êµ¬í˜„ì²´
public class MicrometerMetricsProvider implements MetricsProvider {
    private final Counter successCounter;
    private final Counter failureCounter;
    private final Counter retryCounter;
    
    public MicrometerMetricsProvider(MeterRegistry meterRegistry) {
        this.successCounter = Counter.builder("requests.success")
            .register(meterRegistry);
        this.failureCounter = Counter.builder("requests.failure")
            .register(meterRegistry);
        this.retryCounter = Counter.builder("requests.retry")
            .register(meterRegistry);
    }
    
    @Override
    public void incrementSuccess() {
        successCounter.increment();
    }
    
    @Override
    public void incrementFailure() {
        failureCounter.increment();
    }
    
    @Override
    public void incrementRetry() {
        retryCounter.increment();
    }
}
```

**ì‚¬ìš© ì˜ˆì œ**
```java
// Codahale Metrics ì‚¬ìš©
MetricRegistry codahaleRegistry = new MetricRegistry();
MetricsProvider codahaleProvider = new DefaultMetricsProvider(codahaleRegistry);
HttpClientExecution client1 = new HttpClientExecution(codahaleProvider, 3, httpClient);

// Micrometer ì‚¬ìš©
MeterRegistry micrometerRegistry = new SimpleMeterRegistry();
MetricsProvider micrometerProvider = new MicrometerMetricsProvider(micrometerRegistry);
HttpClientExecution client2 = new HttpClientExecution(micrometerProvider, 3, httpClient);
```

**ì´ ì„¤ê³„ì˜ ì¥ì **
- **ë‚®ì€ ê²°í•©ë„**: íŠ¹ì • ë©”íŠ¸ë¦­ ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ì˜ì¡´í•˜ì§€ ì•ŠìŒ
- **ë†’ì€ í™•ì¥ì„±**: ìƒˆë¡œìš´ ë©”íŠ¸ë¦­ ì‹œìŠ¤í…œ ì‰½ê²Œ ì¶”ê°€ ê°€ëŠ¥
- **í…ŒìŠ¤íŠ¸ ìš©ì´ì„±**: Mock ê°ì²´ë¡œ ì‰½ê²Œ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥
- **ì¬ì‚¬ìš©ì„±**: ë‹¤ì–‘í•œ í™˜ê²½ì—ì„œ ë™ì¼í•œ ì½”ë“œ ì¬ì‚¬ìš©

## í•µì‹¬ ì›ì¹™ ë° ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤

### âœ… ë°˜ë“œì‹œ í•´ì•¼ í•  ê²ƒ

**1. êµ¬ì²´ì ì´ê³  ì˜ë¯¸ìˆëŠ” ì˜ˆì™¸ ì‚¬ìš©**
```java
// âŒ ë„ˆë¬´ ì¼ë°˜ì 
throw new Exception("Something went wrong");

// âœ… êµ¬ì²´ì ì´ê³  ì˜ë¯¸ìˆëŠ” ì˜ˆì™¸
throw new IllegalArgumentException("Age cannot be negative: " + age);
```

**2. ìì› ìë™ ê´€ë¦¬**
```java
// âœ… try-with-resources ì‚¬ìš©
try (FileInputStream fis = new FileInputStream(file);
     BufferedReader reader = new BufferedReader(new InputStreamReader(fis))) {
    return reader.lines().collect(Collectors.toList());
}
```

**3. ë„ë©”ì¸ ì˜ˆì™¸ë¡œ íƒ€ì‚¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ ê²©ë¦¬**
```java
// âœ… ë„ë©”ì¸ ì˜ˆì™¸ë¡œ ê°ì‹¸ê¸°
public void saveUser(User user) throws UserServiceException {
    try {
        database.save(user);
    } catch (SQLException e) {
        throw new UserServiceException("Failed to save user: " + user.getId(), e);
    }
}
```

**4. ì ì ˆí•œ ë¡œê¹…ê³¼ ë©”íŠ¸ë¦­**
```java
try {
    processRequest(request);
    metricsProvider.incrementSuccess();
} catch (Exception e) {
    logger.error("Failed to process request: {}", request.getId(), e);
    metricsProvider.incrementFailure();
    throw new ProcessingException("Request processing failed", e);
}
```

### âŒ ì ˆëŒ€ í•˜ì§€ ë§ì•„ì•¼ í•  ê²ƒ

**1. ì˜ˆì™¸ ë¬´ì‹œ**
```java
// âŒ ì ˆëŒ€ ê¸ˆì§€
try {
    riskyOperation();
} catch (Exception e) {
    // ë¬´ì‹œí•˜ì§€ ë§ ê²ƒ!
}

// âœ… ìµœì†Œí•œ ë¡œê¹…
try {
    riskyOperation();
} catch (Exception e) {
    logger.warn("Operation failed, continuing with default behavior", e);
    useDefaultBehavior();
}
```

**2. ê³¼ë„í•œ ì¼ë°˜í™”**
```java
// âŒ ëª¨ë“  ì˜ˆì™¸ë¥¼ ë™ì¼í•˜ê²Œ ì²˜ë¦¬
try {
    complexOperation();
} catch (Exception e) {
    return "error";
}

// âœ… ì˜ˆì™¸ë³„ ì ì ˆí•œ ì²˜ë¦¬
try {
    complexOperation();
} catch (ValidationException e) {
    return handleValidationError(e);
} catch (NetworkException e) {
    return handleNetworkError(e);
} catch (Exception e) {
    logger.error("Unexpected error", e);
    return handleUnexpectedError(e);
}
```

**3. ì œì–´ íë¦„ ëª©ì ìœ¼ë¡œ ì˜ˆì™¸ ì‚¬ìš©**
```java
// âŒ ì œì–´ íë¦„ì— ì˜ˆì™¸ ì‚¬ìš© ê¸ˆì§€
try {
    return users.get(index);
} catch (IndexOutOfBoundsException e) {
    return null;
}

// âœ… ì ì ˆí•œ ì¡°ê±´ ê²€ì‚¬
if (index >= 0 && index < users.size()) {
    return users.get(index);
}
return null;
```

### ğŸ¯ ì„±ëŠ¥ ìµœì í™” ê°€ì´ë“œ

**1. ìŠ¤íƒ ì¶”ì  ë¹„ìš© ì¸ì‹**
```java
// ì„±ëŠ¥ì´ ì¤‘ìš”í•œ ê²½ìš° ìŠ¤íƒ ì¶”ì  ì—†ëŠ” ì˜ˆì™¸ ì‚¬ìš© ê³ ë ¤
public class NoStackTraceException extends RuntimeException {
    @Override
    public synchronized Throwable fillInStackTrace() {
        return this; // ìŠ¤íƒ ì¶”ì  ìƒì„±í•˜ì§€ ì•ŠìŒ
    }
}
```

**2. ì˜ˆì™¸ ê°ì²´ ì¬ì‚¬ìš© (ë§¤ìš° íŠ¹ìˆ˜í•œ ê²½ìš°)**
```java
// ë§¤ìš° ë¹ˆë²ˆí•œ ì˜ˆì™¸ì˜ ê²½ìš°ì—ë§Œ ê³ ë ¤
private static final IllegalStateException INVALID_STATE = 
    new IllegalStateException("Invalid state");

// ì‚¬ìš© ì‹œ
if (state != VALID) {
    throw INVALID_STATE;
}
```

**3. ì¡°ê±´ ê²€ì‚¬ ìš°ì„ **
```java
// âœ… ì˜ˆì™¸ë³´ë‹¤ëŠ” ì¡°ê±´ ê²€ì‚¬ê°€ ì„±ëŠ¥ìƒ ìœ ë¦¬
public String getProperty(String key) {
    if (key == null || properties == null) {
        return null;
    }
    return properties.get(key);
}
```

ì´ëŸ¬í•œ ì›ì¹™ë“¤ì„ ë”°ë¥´ë©´ ê²¬ê³ í•˜ê³  ìœ ì§€ë³´ìˆ˜í•˜ê¸° ì‰¬ìš´ ì˜ˆì™¸ ì²˜ë¦¬ ì½”ë“œë¥¼ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.